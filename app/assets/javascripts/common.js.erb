$.extend($.expr[':'], {
  'containsi': function(elem, i, match, array)
  {
    return (elem.textContent || elem.innerText || '').toLowerCase()
    .indexOf((match[3] || "").toLowerCase()) >= 0;
  }
});



$(document).on('click', '.fa-bars', function(){
  $('.resp-menu').toggle('slide','slow', function(){
    $('.on-icon').toggleClass('hidden');
  });
  $('.fixed .fa').toggleClass('fa-bars fa-times', 'slow');
  $('.fixed').toggleClass('bg-brand', 'slow');
});

$(document).on('click', '#admin-collapse', function(){
  $('.left-menu').toggle('slide', 'slow', function(){
    $(this).toggleClass('toggled');
  });
});

$(document).on('click', '.fixed .fa-times', function(){
  $('.resp-menu').toggle('slide','slow', function(){
    $('.on-icon').toggleClass('hidden');
  });
  $('.fixed .fa').toggleClass('fa-bars fa-times', 'slow');
  $('.fixed').toggleClass('bg-brand', 'slow');
});

$(document).on('click','.position-modal span', function(){
  $('.modal-body').html('<div class="text-center h1"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></div>');
});


$(document).on('click','.resp-menu  .dropdown li', function(){
  $('.dropdown-menus', this).toggle();
});


$(document).ready(function(){

  $('input[name="search"]').on('keyup', function(event){
    var search = $(this).val();
    var key = event.which || event.keyCode || event.charCode;
    if(search == ''){
      $('.modal div').show();
    }else{
      $('.modal').find('.as_btn:not(:containsi("'+search+'"))').closest('div').hide();
      $('.modal').find('.as_btn:containsi("'+search+'")').closest('div').show();
    }
  });
  $(document).on('click', '#clear-search', function(){
    $('input[name="search"]').val('');
    $('.modal div').show();
  });


  $('[data-mask]').each(function(index, value){
    element = $(value)
    element.mask($(value).data('mask'), {placeholder: '-'})
  });

  $('.clockpicker').clockpicker(
    {'default': 'now',
      autoclose: true,
      donetext: 'Готово!'}
    );


});

$(document).on('keyup','#subposition_quantity', function (e) {
  var input = this;
  setTimeout(function(){
    if ($(input).val()){
      $(input).closest('form').submit();
    }
  }, 1000)
  return false;
  });

$(document).on('mouseenter touchstart', '[data-item-id]', function(){
  $('[data-item-id] a, [data-item-id] span').each(function(index, value){
    element = $(value)
    element.popover({
      trigger: 'hover',
      placement: 'bottom',
      container: 'body',
      html: 'true',
      content: function(){
        var imgSrc = $(this).closest('.item').find('.popover-img img').attr('src');
        return '<img src ="' + imgSrc + '" />'
      }
    });
  });
});

