$.extend($.expr[':'], {
  'containsi': function(elem, i, match, array)
  {
    return (elem.textContent || elem.innerText || '').toLowerCase()
    .indexOf((match[3] || "").toLowerCase()) >= 0;
  }
});


$(document).on('click', '#icon-wrapper', function(){
  $('#resp-menu').toggle('slide',300);
  $(this).find('[data-fa-i2svg]').toggleClass('fa-bars', 300).toggleClass('fa-times', 300);
  $('.resp-menu-bar').toggleClass('bg-teal', 150);
  FontAwesome.dom.i2svg();
});

$(document).on('turbolinks:load', function(){
  if ($('#resp-fixed').length){
    var top = $('#resp-fixed').offset().top;
    $(window).scroll(function(){
      var currentScroll = $(window).scrollTop();
      if (currentScroll > top){
        $('#resp-fixed').addClass('fixed-top');
      }else{
        $('#resp-fixed').removeClass('fixed-top bg-gradient-info');
      }
    })
  }
});



$(document).on('click','.position-modal .as_btn', function(){
  $('.modal-body').html('<div class="text-center h1"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></div>');
});

$(document).on('hidden.bs.modal', '.position-modal', function(){
  $('.modal-body', this).html();
});


$(document).on('click','#resp-menu  .dropdown li', function(){
  $('.dropdown-menus', this).toggle();
});


$(document).on('ready, turbolinks:load', function(){

  $('input[name="search"]').on('keyup', function(event){
    var search = $(this).val();
    var key = event.which || event.keyCode || event.charCode;
    if(search == ''){
      $('.modal div').show();
    }else{
      $('.modal').find('.as_btn:not(:containsi("'+search+'"))').closest('div').hide();
      $('.modal').find('.as_btn:containsi("'+search+'")').closest('div').show();
    }
  });
  $(document).on('click', '#clear-search', function(){
    $('input[name="search"]').val('');
    $('.modal div').show();
  });

$(document).on('turbolinks:load', function(){
  $('[data-mask]').each(function(index, value){
    element = $(value)
    element.mask($(value).data('mask'), {placeholder: '-'})
  });

  $('.clockpicker').clockpicker(
    {'default': 'now',
      autoclose: true,
      donetext: 'Готово!'}
    );

})



});

$(document).on('keyup','#subposition_quantity', function (e) {
  var input = this;
  setTimeout(function(){
    if ($(input).val()){
      $(input).closest('form').submit();
    }
  }, 1100)
  return false;
  });

$(document).on('mouseenter touchstart', '[data-product-id], [data-item-id]' , function(){
  $('[data-item-id] img, [data-product-id] img').each(function(index, value){
    element = $(value)
    element.popover({
      trigger: 'hover',
      placement: 'top',
      container: 'body',
      animation: false,
      content: function(){
        var name = $(this).closest('.item').data('content');
        return name;
      }
    });
  });
});

$(document).on('ready, turbolinks:load', function(){
  $('.slider').slick({
    slidesToShow: 4,
    slidesToScroll: 1,
    focusOnSelect: true,
    autoplay: true,
    autoplaySpeed: 2000,
    arrows: true,
    prevArrow: '<i class="fa fa-chevron-left"></i>',
    nextArrow: '<i class="fa fa-chevron-right"></i>',
    variableWidth: true,
    lazyLoad: 'progressive'
  });
});




$(document).on('ready, turbolinks:load', function(){
  $('#more').hide();
  var rows = $('.item');
  if (rows.length > 4){
    $('#more').show();
    $(rows[3]).addClass('grad-1');
    for (i = 4; i < rows.length; i++) {
      $(rows[i]).hide();
    }
    $('#more').on('click', function(){
      for (i = 4; i < rows.length; i++) {
        $(rows[i]).toggle(100);
      }
      $(rows[3]).toggleClass('grad-1');
      $(this).find('i').toggleClass('fa-chevron-up').toggleClass('fa-chevron-down');
      $(this).toggleClass('with-grad');
      $(this).find('.small').text(function(){
        var text = $(this).text();
        return text == 'Спрятать' ? "Показать все" : "Спрятать"
      })
    });
  }
});


$(function () {
  $('[data-toggle="tooltip"]').tooltip();
})

$(function () {
  $('[data-site]').tooltip();
})
