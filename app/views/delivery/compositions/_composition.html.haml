- cache composition do
  .d-flex#reverse{itemscope: true, itemtype: "http://schema.org/Product"}
    %meta{itemprop: 'name', content: "Композиция № #{@comp.id} из воздушных шаров | Шариковая фея"}
    .comp-desc
      %p.strong.text-uppercase.mb-0
        В композицию входит:
      #products
        %table.table
          %tbody
            %thead
              %tr
                %th.text-center
                  Шар
                %th.text-center
                  Цена
                %th.text-center
                  Количество
          - composition.products.uniq.each do |product|
            %tr.item.text-center{data: {item_id: "#{product.id}", content: "#{product.complex_name}" }}
              %td.text-center
                %span{style: 'border-bottom: 1px dashed black; cursor: pointer;'}
                  = image_tag product.image(:small), alt: 'Воздушный шар' + " " + product.complex_name
              %td.h5.strong
                = product.price_with_helium.round(0)
                %small
                  руб.
              %td.h5.strong
                = composition.products.where(id: product.id).count
                %small
                  шт.
        #more.text-center.w-100.lead.with-grad{style: 'cursor: pointer; line-height: 0.3rem;'}
          .small.lead
            Показать все
          %br
          %i.fa.fa-chevron-down
      .row#total.mt-2.py-2.align-items-center.m-0
        .col-8.d-inline-flex{itemprop: 'offers', itemscope: true, itemtype: "http://schema.org/Offer"}
          .t1.pl-3.text-uppercase.strong.p-0.lead
            Итого
          .t2.strong.h2.p-0.pl-3.text-secondary.m-0.text-right{itemprop: 'price'}
            = composition.comp_price.round(0)
          .strong.pl-1{itemprop: 'priceCurrency', content: 'RUB'}
            руб.
          %link{itemprop: 'availability', href: 'http://schema.org/Preorder'}
        .col-4.d-inline-flex.px-2
          - unless @cart.compositions.include?(composition)
            = link_to 'В корзину', add_to_cart_path(composition), class: "btn btn-info btn-block add-to-cart#{composition.id}", id: 'ga-add-to-cart', data: {disable_with: 'Добавляем...'}, remote: true, method: :post
          - else
            = link_to 'Перейти в корзину', my_cart_path, class: 'btn btn-success btn-block'
          / .small.text-center.text-danger.d-flex
          /   Вы cможете изменить состав композиции в корзине
      .row
        .col-12.text-center
          Вы можете изменить состав композиции в корзине
      .row.mt-3.align-items-center
        .h6.w-100.text-center
          Способы оплаты:
        .col-6.text-info.d-flex.justify-content-center.align-items-center
          %i.fa.fa-money.fa-2x.pr-1
          Наличными
          курьеру
        .col-6.text-info.d-flex.justify-content-center.align-items-center
          %i.fa.fa-credit-card.fa-2x.pr-1
          Банковской
          картой
    .comp-image
      = link_to :back, class: 'btn btn-outline-info btn-sm my-3 d-none d-lg-inline-block' do
        %i.fa.fa-chevron-left
        Вернуться в каталог
      = image_tag composition.img.url(:preview), class: 'img-fluid img-thumbnail', itemprop: 'image', alt: composition.title
      .row.comp-text.text-secondary.justify-content-end.align-items-center.mt-3
        .text-center.mb-2{itemprop: 'description'}
          Композиция из воздушных шаров на #{composition.tags.map(&:name).join(', ')}, #{composition.receivers.map(&:title).join(', ') if composition.receivers}
        .d-flex-inline.mr-5
          = social_share_button_tag("Шариковая фея | Композиция №#{composition.id} из воздушных шаров", image: 'https:' + composition.img.url(:preview), url: request.original_url, desc: "Композиция из воздушных шаров на #{composition.tags.map(&:name).join(', ')}, #{composition.receivers.map(&:title).join(', ')}", 'data-toggle': 'tooltip' )
        .d-flex-inline.lead.mr-5{title: "Просмотрели", data: {toggle: 'tooltip'}}
          %i.fa.fa-eye
          = composition.views
        .d-flex-inline.lead.mr-4{title: "Заказали" , data: {toggle: 'tooltip'}}
          %i.fa.fa-shopping-basket
          = composition.orders.count + 3
  %h3.col-12.text-center.strong.my-5
    Похожие композиции
  .row.justify-content-around.compositions{itemprop: 'isSimilarTo'}
    = render partial: 'delivery/main/thumb_composition', collection: composition.related.limit(3), as: :c

