- cache composition do
  .row#reverse
    .comp-desc
      .row.mt-2.mb-4
        .col-12
          - if composition.tags.any?
            %p{itemprop: 'description'}
              Композиция на
              - composition.tags.each do |tag|
                %span.text-secondary
                  = link_to tag_path(tag), class: 'text-info' do
                    #{tag.name.capitalize},

      %p.strong.text-uppercase.mb-1
        В композицию входит:
      #products
        %table.table
          %tbody
          - composition.products.uniq.each do |product|
            %tr.item{data: {item_id: "#{product.id}"}}
              %td
                %span{style: 'border-bottom: 1px dashed black; cursor: pointer;'}
                  = product.complex_name
              %td.h5.strong
                = composition.products.where(id: product.id).count
                %small
                  шт.
              %td.h5.strong
                = product.price_with_helium.round(0)
                %small
                  руб.
              %td.popover-img{style: 'display: none;'}
                = image_tag product.image(:small)
      .row.my-5.align-items-center
        .h6.col-4.text-uppercase
          Способы оплаты
        .col-4
          .row.align-items-center
            .col-2.p-0
              %i.fa.fa-money.fa-2x
            .col-10.p-0.pl-2.lh-1
              Наличными
              %br
              курьеру
        .col-4
          .row.align-items-center
            .col-2.p-0
              %i.fa.fa-credit-card.fa-2x
            .col-10.p-0.pl-2.lh-1
              Банковской
              %br
              картой
      .row#total.mt-5.p-2
        .col-6
          .row
            .col-3.pr-4.pl-3.text-uppercase
              Итого
            .col-4.strong.h1.p-0.pl-2.text-secondary.m-0.text-right
              = composition.comp_price.round(0)
            .col-3.pl-1.strong
              руб.
        .col-6
          - unless @cart.compositions.include?(composition)
            = link_to 'Добавить в корзину', add_to_cart_path(composition), class: "btn btn-info btn-block add-to-cart#{composition.id}", id: 'ga-add-to-cart', data: {disable_with: 'Добавляем...'}, remote: true, method: :post
          - else
            = link_to 'Перейти в корзину', cart_path(@cart), class: 'btn btn-success btn-block'
    .comp-image.text-right
      = link_to root_path, class: 'btn btn-outline-info btn-sm mb-2' do
        %i.fa.fa-chevron-left
        Вернуться в каталог
      = image_tag composition.img.url(:preview), class: 'img-fluid', itemprop: 'image'
  %h3.col-12.text-center.strong.my-5
    Похожие композиции
  .container
    .row.justify-content-around.card-deck.compositions.card-group
      = render partial: 'delivery/main/thumb_composition', collection: composition.related.limit(3), as: :c

