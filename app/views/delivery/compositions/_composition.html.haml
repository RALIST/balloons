.row
  .col-md-4.col-xs-12.text-center
    = image_tag composition.img.url(:large), class: 'img-fluid', style: 'margin: 0 auto 2em;'
  .col-md-6.col-xs-12
    %p.bg-brand
      %strong
        В композицию входит:
    %table.table.table-bordered.table-condensed
      %tbody
        %thead
          %th
            Название
          %th
            Кол-во
          %th
            Цена
      - composition.products.uniq.each do |product|
        %tr.item{data: {item_id: "#{product.id}"}}
          %td
            %span{style: 'cursor: pointer; border-bottom: 1px dashed black;'}
              - case product.type.name
              - when 'латексные шары'
                = "#{product.size.in_inch.to_i}''(#{product.size.in_cm.to_i}см) #{product.texture.name} #{product.tone.name}"
              - when 'фольгированные шары'
                = "#{product.size.in_inch.to_i}''(#{product.size.in_cm.to_i}см)" if product.size
                = product.item.name
              - when 'товары для композиций'
                = "#{product.size.in_inch.to_i}''(#{product.size.in_cm.to_i}см)" if product.size
                = product.name
          %td
            = composition.products.where(id: product.id).count
            шт.
          %td= number_to_currency(product.price_with_helium, precision: 0)
          %td.popover-img{style: 'display: none;'}
            = image_tag product.image(:small)
      %tr.text-right
        %td
        %td
          %strong
            Итого:
        %td
          %strong
            = number_to_currency(composition.price, precision: 0)

    .row
      .col-md-12.col-xs-12
        - if composition.tags.any?
          %p
            Композиция на
            - composition.tags.each do |tag|
              %span
                = link_to by_tag_path(tag.name) do
                  #{tag.name.capitalize},
    .row
      .col-md-4.col-xs-12
        - unless @cart.compositions.include?(composition)
          = button_to 'Добавить в корзину', add_to_cart_path(composition), class: "btn btn-info btn-block add-to-cart#{composition.id}", data: {disable_with: 'Добавляем...'}, remote: true
        - else
          .btn.btn-success{disabled: true}
            Добавлено в корзину
  .col-md-2.col-xs-12.text-center
    %p
      %strong
        Похожие
    .row
      - composition.related.limit(3).each do |related|
        .col-md-12.col-xs-4
          = link_to root_path(id: related.id), remote: true  do
            = image_tag related.img.url(:small), class: 'img-responsive', style: 'margin: auto;'
.modal-footer

