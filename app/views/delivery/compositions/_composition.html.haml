- cache composition do
  .d-flex#reverse
    .comp-desc
      %p.strong.text-uppercase.mb-1
        В композицию входит:
      #products
        %table.table
          %tbody
          - composition.products.uniq.each do |product|
            %tr.item{data: {item_id: "#{product.id}"}}
              %td
                %span{style: 'border-bottom: 1px dashed black; cursor: pointer;'}
                  = product.complex_name
              %td.h5.strong
                = composition.products.where(id: product.id).count
                %small
                  шт.
              %td.h5.strong
                = product.price_with_helium.round(0)
                %small
                  руб.
              %td.popover-img{style: 'display: none;'}
                = image_tag product.image(:small)
      .row#total.mt-2.py-2.align-items-center.m-0
        .col-8.d-inline-flex
          .t1.pl-3.text-uppercase.strong.p-0
            Итого
          .t2.strong.h1.p-0.pl-3.text-secondary.m-0.text-right
            = composition.comp_price.round(0)
          .strong.pl-1
            руб.
        .col-4.d-inline-flex.px-2
          - unless @cart.compositions.include?(composition)
            = link_to 'В корзину', add_to_cart_path(composition), class: "btn btn-info btn-block add-to-cart#{composition.id}", id: 'ga-add-to-cart', data: {disable_with: 'Добавляем...'}, remote: true, method: :post
          - else
            = link_to 'Перейти в корзину', my_cart_path, class: 'btn btn-success btn-block'
          / .small.text-center.text-danger.d-flex
          /   Вы cможете изменить состав композиции в корзине
      .row.mt-3
        .h6.w-100.text-center
          Способы оплаты:
        .col-6.text-info.align-items-center.d-flex.lh-1
          %i.fa.fa-money.fa-2x.pr-1
          Наличными
          курьеру
        .col-6.text-info.align-items-center.d-flex.lh-1
          %i.fa.fa-credit-card.fa-2x.pr-1
          Банковской
          картой
    .comp-image.text-right
      = link_to root_path, class: 'btn btn-outline-info btn-sm mb-2' do
        %i.fa.fa-chevron-left
        Вернуться в каталог
      = image_tag composition.img.url(:preview), class: 'img-fluid img-thumbnail', itemprop: 'image'
  %h3.col-12.text-center.strong.my-5
    Похожие композиции
  .container
    .row.justify-content-around.compositions
      = render partial: 'delivery/main/thumb_composition', collection: composition.related.limit(3), as: :c

